<div class="space-y-8">
  <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
    <div class="w-full flex-1">
      <%= form_with url: questions_path, method: :get, local: true, html: { class: "flex flex-col gap-4 rounded-lg bg-card p-4", data: { controller: "filters", filters_delay_value: 500 } } do |form| %>
        <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between md:gap-4">
          <div class="flex w-full flex-col gap-3 md:flex-row md:items-center md:gap-4">
            <div class="relative w-full md:max-w-sm lg:max-w-md">
              <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-muted-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                  <circle cx="11" cy="11" r="8" />
                  <path d="m21 21-3.5-3.5" />
                </svg>
              </span>
              <%= form.text_field :q, value: @filters[:q], placeholder: "Buscar por título", class: "input pl-9", data: { action: "input->filters#submit" } %>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <%= multi_filter_dropdown(
                    form,
                    param: :difficulty,
                    label: "Dificuldade",
                    options: @difficulty_options,
                    selected_values: @filters[:difficulty],
                    counts: @difficulty_counts,
                    all_label: "Todas"
                  ) %>
              <%= multi_filter_dropdown(
                    form,
                    param: :area,
                    label: "Área",
                    options: @area_options,
                    selected_values: @filters[:area],
                    counts: @area_counts,
                    all_label: "Todas"
                  ) %>
              <%= multi_filter_dropdown(
                    form,
                    param: :theme,
                    label: "Tema",
                    options: @theme_options,
                    selected_values: @filters[:theme],
                    counts: @theme_counts,
                    all_label: "Todos"
                  ) %>
              <%= multi_filter_dropdown(
                    form,
                    param: :status,
                    label: "Status",
                    options: @status_options,
                    selected_values: @filters[:status],
                    counts: @status_counts,
                    all_label: "Todos"
                  ) %>
              <%= link_to questions_path, class: "btn btn-ghost btn-sm gap-2" do %>
                Limpar filtros
                <%= image_tag "icons/x-icon.svg", alt: "", class: "h-3 w-3" %>
              <% end %>
            </div>
          </div>
          <div class="flex items-center gap-2 md:ml-auto">
            <%= link_to "Configurar Prova", questions_blueprints_path, class: "btn btn-secondary btn-sm" %>
            <%= link_to "Adicionar questão", new_question_path, class: "btn btn-primary btn-sm" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="overflow-x-auto">
    <div class="min-w-full lg:min-w-[720px]">
      <div class="<%= table_container_class %>">
        <table class="w-full border-collapse text-sm text-foreground">
          <thead class="bg-muted/40 text-xs uppercase tracking-wide text-foreground">
            <tr>
              <th scope="col" class="px-6 py-3 text-left font-semibold">Item</th>
              <th scope="col" class="px-6 py-3 text-left font-semibold">Resumo</th>
              <th scope="col" class="px-6 py-3 text-left font-semibold">Metadados</th>
              <th scope="col" class="px-6 py-3 text-left font-semibold">Status</th>
              <th scope="col" class="px-6 py-3 text-left font-semibold">Ações</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border">
            <% if @questions.any? %>
              <% @questions.each do |question| %>
                <tr class="transition-colors hover:bg-muted/30">
                  <td class="px-6 py-4 text-xs font-medium text-muted-foreground">
                    <span class="block text-sm font-semibold text-foreground">#<%= question.id %></span>
                    <span class="block">UUID: <%= question.item_id %></span>
                    <span class="block">Tipo: <%= question.question_type_label %></span>
                  </td>
                  <td class="px-6 py-4">
                    <p class="text-sm text-foreground"><%= truncate(question.statement, length: 130) %></p>
                    <div class="mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground">
                      <span><strong>Área:</strong> <%= question_area_label(question) %></span>
                      <span><strong>Tema:</strong> <%= question_theme_label(question) %></span>
                    </div>
                  </td>
                  <td class="px-6 py-4 text-xs text-muted-foreground">
                    <% if question.difficulty.present? %>
                      <span class="<%= difficulty_badge_class(question.difficulty) %>"><%= difficulty_label(question.difficulty) %></span>
                    <% end %>
                    <div class="mt-2 space-y-1">
                      <% if question.year_of_application.present? %>
                        <p>Ano: <strong><%= question.year_of_application %></strong></p>
                      <% end %>
                      <% if question.level.present? %>
                        <p>Nível: <strong><%= question.level.titleize %></strong></p>
                      <% end %>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <%= question_status_badge(question) %>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
                      <%= link_to "Editar", edit_question_path(question), class: "btn btn-secondary btn-xs" %>
                      <%= link_to "Abrir revisão", edit_question_path(question, current_step: 4), class: "btn btn-ghost btn-xs" %>
                      <% if question.status_review? %>
                        <%= button_to "Aprovar", approve_question_path(question), method: :post, class: "btn btn-primary btn-xs", data: { turbo_confirm: "Aprovar esta questão?" } %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="5" class="px-6 py-10 text-center text-sm text-muted-foreground">
                  Nenhuma questão encontrada com os filtros selecionados.
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% pagination_params = pagination_base_params(@filters) %>
      <div class="mt-4 flex flex-col gap-3 rounded-lg border border-border bg-card px-6 py-4 sm:flex-row sm:items-center sm:justify-between">
        <span class="text-sm text-muted-foreground">Página <%= @page %> de <%= @total_pages %></span>
        <div class="flex items-center gap-2">
          <%= pagination_button(path_helper: method(:questions_path), params: pagination_params, page: 1, icon: "icons/chevrons-left-icon.svg", label: "Primeira página", disabled: @page <= 1) %>
          <%= pagination_button(path_helper: method(:questions_path), params: pagination_params, page: (@page - 1).clamp(1, @total_pages), icon: "icons/chevron-left-icon.svg", label: "Página anterior", disabled: @page <= 1) %>
          <%= pagination_button(path_helper: method(:questions_path), params: pagination_params, page: (@page + 1).clamp(1, @total_pages), icon: "icons/chevron-right-icon.svg", label: "Próxima página", disabled: @page >= @total_pages) %>
          <%= pagination_button(path_helper: method(:questions_path), params: pagination_params, page: @total_pages, icon: "icons/chevrons-right-icon.svg", label: "Última página", disabled: @page >= @total_pages) %>
        </div>
      </div>
    </div>
  </div>
</div>
