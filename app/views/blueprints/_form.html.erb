<%= form_with model: @blueprint, url: form_url, method: form_method, local: true,
              html: { class: "space-y-6", data: { controller: "blueprint-form", blueprint_form_area_index_value: @blueprint.areas.size } } do |form| %>
  <div class="grid gap-4 md:grid-cols-3">
    <div>
      <%= form.label :modality, "Modalidade", class: "text-sm font-medium text-muted-foreground" %>
      <%= form.select :modality, @modality_options, {}, class: "select mt-1" %>
    </div>
    <div>
      <%= form.label :year, "Ano", class: "text-sm font-medium text-muted-foreground" %>
      <%= form.number_field :year, class: "input mt-1", min: 2000, step: 1 %>
    </div>
    <div>
      <%= form.label :version, "Versão", class: "text-sm font-medium text-muted-foreground" %>
      <%= form.number_field :version, class: "input mt-1", min: 1, step: 1 %>
    </div>
  </div>

  <div class="grid gap-4 md:grid-cols-2">
    <div>
      <%= form.label :title, "Título", class: "text-sm font-medium text-muted-foreground" %>
      <%= form.text_field :title, class: "input mt-1", placeholder: "Ex.: Blueprint P2 2025" %>
    </div>
    <div>
      <%= form.label :notes, "Notas", class: "text-sm font-medium text-muted-foreground" %>
      <%= form.text_area :notes, class: "input mt-1 h-24", placeholder: "Observações internas" %>
    </div>
  </div>

  <div class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">Áreas e componentes</h2>
      <button type="button" class="btn btn-outline btn-sm" data-action="blueprint-form#addArea">Adicionar área</button>
    </div>

    <div class="space-y-4" data-blueprint-form-target="areas">
      <%= form.fields_for :areas do |area_fields| %>
        <%= render "area_fields", f: area_fields %>
      <% end %>
    </div>

    <template data-blueprint-form-target="areaTemplate">
      <%= form.fields_for :areas, BlueprintArea.new(area: BlueprintArea::AREAS.first), child_index: "NEW_AREA" do |area_fields| %>
        <%= render "area_fields", f: area_fields %>
      <% end %>
    </template>
  </div>

  <div class="flex items-center justify-between">
    <div class="text-sm text-muted-foreground">
      Status: <span class="font-semibold"><%= @blueprint.status.humanize %></span>
    </div>
    <div class="flex flex-wrap items-center gap-2">
      <%= link_to "Cancelar", blueprints_path, class: "btn btn-ghost btn-sm" %>
      <%= form.submit "Salvar rascunho", class: "btn btn-secondary btn-sm" %>
    </div>
  </div>
<% end %>

<div class="flex items-center justify-end gap-2 border-t border-border pt-4">
  <% if @blueprint.persisted? %>
    <%= button_to "Duplicar versão", duplicate_blueprint_path(@blueprint), method: :post, class: "btn btn-outline btn-sm" %>
    <% if @blueprint.published? %>
      <%= button_to "Retirar", retire_blueprint_path(@blueprint), method: :post, class: "btn btn-destructive btn-sm", data: { turbo_confirm: "Confirmar retirada?" } %>
    <% else %>
      <%= button_to "Publicar", publish_blueprint_path(@blueprint), method: :post, class: "btn btn-primary btn-sm", data: { turbo_confirm: "Publicar blueprint?" } %>
    <% end %>
  <% end %>
</div>
